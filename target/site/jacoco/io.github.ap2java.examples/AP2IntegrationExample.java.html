<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AP2IntegrationExample.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">AP2Java</a> &gt; <a href="index.source.html" class="el_package">io.github.ap2java.examples</a> &gt; <span class="el_source">AP2IntegrationExample.java</span></div><h1>AP2IntegrationExample.java</h1><pre class="source lang-java linenums">package io.github.ap2java.examples;

import io.github.ap2java.client.AP2Client;
import io.github.ap2java.domain.EnhancedCapabilities;
import io.github.ap2java.domain.EnhancedMessage;
import io.github.ap2java.domain.EnhancedTask;
import io.github.ap2java.domain.PaymentEnabledAgentCard;
import io.github.ap2java.domain.PaymentProvider;
import io.github.ap2java.payment.SamplePaymentProcessor;
import io.github.vishalmysore.a2a.domain.*;
import lombok.extern.slf4j.Slf4j;

import java.util.Arrays;
import java.util.HashMap;
import java.util.Map;
import java.util.UUID;

/**
 * Example demonstrating integration of AP2 with the a2ajava agent system.
 */
<span class="nc" id="L21">@Slf4j</span>
<span class="nc" id="L22">public class AP2IntegrationExample {</span>
    
    public static void main(String[] args) {
<span class="nc" id="L25">        log.info(&quot;Starting AP2 integration example&quot;);</span>
        
        try {
            // Create payment-enabled agent
<span class="nc" id="L29">            PaymentEnabledAgentCard agentCard = createPaymentEnabledAgentCard();</span>
            
            // Create AP2 client
<span class="nc" id="L32">            AP2Client ap2Client = new AP2Client(new SamplePaymentProcessor(), agentCard);</span>
            
            // Create message for payment request
<span class="nc" id="L35">            Message paymentRequestMessage = createPaymentRequestMessage();</span>
            
            // Process the message
<span class="nc" id="L38">            Task task = ap2Client.processMessage(paymentRequestMessage);</span>
            
            // Log task details
<span class="nc" id="L41">            log.info(&quot;Task ID: {}&quot;, task.getId());</span>
            
            // Check if task is EnhancedTask
<span class="nc bnc" id="L44" title="All 2 branches missed.">            if (task instanceof io.github.ap2java.domain.EnhancedTask) {</span>
<span class="nc" id="L45">                io.github.ap2java.domain.EnhancedTask enhancedTask = (io.github.ap2java.domain.EnhancedTask) task;</span>
<span class="nc bnc" id="L46" title="All 2 branches missed.">                log.info(&quot;Task status: {}&quot;, enhancedTask.isCompleted() ? &quot;Completed&quot; : &quot;In Progress&quot;);</span>
<span class="nc" id="L47">            } else {</span>
<span class="nc" id="L48">                log.info(&quot;Task status: Unknown (not an EnhancedTask)&quot;);</span>
            }
            
            // In a real implementation, we would wait for the task to complete
            // and then process the result
            
<span class="nc" id="L54">        } catch (Exception e) {</span>
<span class="nc" id="L55">            log.error(&quot;Error in AP2 integration example&quot;, e);</span>
<span class="nc" id="L56">        }</span>
        
<span class="nc" id="L58">        log.info(&quot;AP2 integration example completed&quot;);</span>
<span class="nc" id="L59">    }</span>
    
    /**
     * Create a payment-enabled agent card.
     *
     * @return The agent card.
     */
    private static PaymentEnabledAgentCard createPaymentEnabledAgentCard() {
<span class="nc" id="L67">        PaymentEnabledAgentCard agentCard = new PaymentEnabledAgentCard();</span>
        
        // Set basic agent properties
<span class="nc" id="L70">        agentCard.setName(&quot;Payment Agent&quot;);</span>
<span class="nc" id="L71">        agentCard.setDescription(&quot;Agent that processes payments&quot;);</span>
<span class="nc" id="L72">        agentCard.setUrl(&quot;https://example.com/payment-agent&quot;);</span>
<span class="nc" id="L73">        agentCard.setVersion(&quot;1.0.0&quot;);</span>
<span class="nc" id="L74">        agentCard.setDocumentationUrl(&quot;https://example.com/docs/payment-agent&quot;);</span>
        
        // Set provider
<span class="nc" id="L77">        Provider provider = new Provider();</span>
<span class="nc" id="L78">        provider.setOrganization(&quot;Example Corp&quot;);</span>
<span class="nc" id="L79">        provider.setUrl(&quot;https://example.com&quot;);</span>
<span class="nc" id="L80">        agentCard.setProvider(provider);</span>
        
        // Set capabilities
<span class="nc" id="L83">        EnhancedCapabilities capabilities = new EnhancedCapabilities();</span>
<span class="nc" id="L84">        capabilities.setStreaming(true);</span>
<span class="nc" id="L85">        capabilities.setPushNotifications(true);</span>
<span class="nc" id="L86">        capabilities.setCustomCapability(&quot;paymentEnabled&quot;, true);</span>
<span class="nc" id="L87">        agentCard.setCapabilities(capabilities);</span>
        
        // Set authentication
<span class="nc" id="L90">        Authentication auth = new Authentication();</span>
<span class="nc" id="L91">        auth.setBearerAuth(&quot;api-key-123&quot;);</span>
<span class="nc" id="L92">        agentCard.setAuthentication(auth);</span>
        
        // Set default modes
<span class="nc" id="L95">        agentCard.setDefaultInputModes(new String[]{&quot;text&quot;});</span>
<span class="nc" id="L96">        agentCard.setDefaultOutputModes(new String[]{&quot;text&quot;, &quot;json&quot;});</span>
        
        // Add payment skills
<span class="nc" id="L99">        Skill createPaymentSkill = createSkill(&quot;createPayment&quot;, &quot;Create a new payment&quot;, </span>
                new String[]{&quot;payment&quot;, &quot;create&quot;});
<span class="nc" id="L101">        Skill authorizePaymentSkill = createSkill(&quot;authorizePayment&quot;, &quot;Authorize a payment&quot;, </span>
                new String[]{&quot;payment&quot;, &quot;authorize&quot;});
<span class="nc" id="L103">        Skill capturePaymentSkill = createSkill(&quot;capturePayment&quot;, &quot;Capture an authorized payment&quot;, </span>
                new String[]{&quot;payment&quot;, &quot;capture&quot;});
        
<span class="nc" id="L106">        agentCard.setSkills(Arrays.asList(createPaymentSkill, authorizePaymentSkill, capturePaymentSkill));</span>
        
        // Set payment provider
<span class="nc" id="L109">        PaymentProvider paymentProvider = PaymentProvider.builder()</span>
<span class="nc" id="L110">                .id(&quot;example-provider&quot;)</span>
<span class="nc" id="L111">                .name(&quot;Example Payment Provider&quot;)</span>
<span class="nc" id="L112">                .description(&quot;Payment processing services&quot;)</span>
<span class="nc" id="L113">                .url(&quot;https://example.com/payments&quot;)</span>
<span class="nc" id="L114">                .apiEndpoint(&quot;https://api.example.com/payments&quot;)</span>
<span class="nc" id="L115">                .type(&quot;multi&quot;)</span>
<span class="nc" id="L116">                .logoUrl(&quot;https://example.com/logo.png&quot;)</span>
<span class="nc" id="L117">                .build();</span>
<span class="nc" id="L118">        agentCard.setPaymentProvider(paymentProvider);</span>
        
        // Set payment capabilities
<span class="nc" id="L121">        agentCard.setSupportedPaymentMethods(new String[]{&quot;credit_card&quot;, &quot;wallet&quot;, &quot;bank_transfer&quot;});</span>
<span class="nc" id="L122">        agentCard.setSupportedCurrencies(new String[]{&quot;USD&quot;, &quot;EUR&quot;, &quot;GBP&quot;});</span>
<span class="nc" id="L123">        agentCard.setCanReceivePayments(true);</span>
<span class="nc" id="L124">        agentCard.setCanMakePayments(true);</span>
<span class="nc" id="L125">        agentCard.setRequiresAuthentication(true);</span>
        
<span class="nc" id="L127">        return agentCard;</span>
    }
    
    /**
     * Create a skill for the agent.
     *
     * @param name        Skill name.
     * @param description Skill description.
     * @param tags        Skill tags.
     * @return The created skill.
     */
    private static Skill createSkill(String name, String description, String[] tags) {
<span class="nc" id="L139">        Skill skill = new Skill();</span>
<span class="nc" id="L140">        skill.setName(name);</span>
<span class="nc" id="L141">        skill.setDescription(description);</span>
<span class="nc" id="L142">        skill.setTags(tags);</span>
<span class="nc" id="L143">        return skill;</span>
    }
    
    /**
     * Create a payment request message.
     *
     * @return The created message.
     */
    private static Message createPaymentRequestMessage() {
<span class="nc" id="L152">        EnhancedMessage message = new EnhancedMessage();</span>
<span class="nc" id="L153">        message.setId(UUID.randomUUID().toString());</span>
<span class="nc" id="L154">        message.setMethod(&quot;createPayment&quot;);</span>
        
        // In a real implementation, the params would include the payment request details
<span class="nc" id="L157">        Map&lt;String, Object&gt; params = new HashMap&lt;&gt;();</span>
<span class="nc" id="L158">        params.put(&quot;amount&quot;, &quot;99.99&quot;);</span>
<span class="nc" id="L159">        params.put(&quot;currencyCode&quot;, &quot;USD&quot;);</span>
<span class="nc" id="L160">        params.put(&quot;description&quot;, &quot;Purchase of Premium Service&quot;);</span>
<span class="nc" id="L161">        params.put(&quot;requestingAgentId&quot;, &quot;agent-123&quot;);</span>
<span class="nc" id="L162">        params.put(&quot;receivingAgentId&quot;, &quot;merchant-456&quot;);</span>
        
<span class="nc" id="L164">        message.setParams(params);</span>
        
<span class="nc" id="L166">        return message;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.10.202304240956</span></div></body></html>