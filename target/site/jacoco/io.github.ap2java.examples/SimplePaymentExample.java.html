<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SimplePaymentExample.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">AP2Java</a> &gt; <a href="index.source.html" class="el_package">io.github.ap2java.examples</a> &gt; <span class="el_source">SimplePaymentExample.java</span></div><h1>SimplePaymentExample.java</h1><pre class="source lang-java linenums">package io.github.ap2java.examples;

import io.github.ap2java.client.AP2Client;
import io.github.ap2java.domain.*;
import io.github.ap2java.payment.PaymentProcessor;
import io.github.ap2java.payment.SamplePaymentProcessor;
import io.github.vishalmysore.a2a.domain.Authentication;
import lombok.extern.slf4j.Slf4j;

import java.math.BigDecimal;
import java.util.HashMap;
import java.util.Map;
import java.util.UUID;
import java.util.concurrent.ExecutionException;

/**
 * Simple example demonstrating the AP2 protocol usage.
 */
<span class="nc" id="L19">@Slf4j</span>
<span class="nc" id="L20">public class SimplePaymentExample {</span>
    
    public static void main(String[] args) {
<span class="nc" id="L23">        log.info(&quot;Starting AP2 simple payment example&quot;);</span>
        
        try {
            // Set up the payment-enabled agent card
<span class="nc" id="L27">            PaymentEnabledAgentCard agentCard = createAgentCard();</span>
            
            // Create a payment processor
<span class="nc" id="L30">            PaymentProcessor paymentProcessor = new SamplePaymentProcessor();</span>
            
            // Create an AP2 client
<span class="nc" id="L33">            AP2Client ap2Client = new AP2Client(paymentProcessor, agentCard);</span>
            
            // Create a payment request
<span class="nc" id="L36">            PaymentRequest paymentRequest = createPaymentRequest();</span>
            
            // Create a payment
<span class="nc" id="L39">            PaymentResponse paymentResponse = ap2Client.createPayment(paymentRequest).get();</span>
<span class="nc" id="L40">            log.info(&quot;Payment created: {}&quot;, paymentResponse);</span>
            
            // Authorize the payment
<span class="nc" id="L43">            paymentResponse = ap2Client.authorizePayment(paymentResponse.getPaymentId(), &quot;auth-token-123&quot;).get();</span>
<span class="nc" id="L44">            log.info(&quot;Payment authorized: {}&quot;, paymentResponse);</span>
            
            // Capture the payment
<span class="nc" id="L47">            paymentResponse = ap2Client.capturePayment(paymentResponse.getPaymentId()).get();</span>
<span class="nc" id="L48">            log.info(&quot;Payment captured: {}&quot;, paymentResponse);</span>
            
            // Check the payment status
<span class="nc" id="L51">            paymentResponse = ap2Client.checkPaymentStatus(paymentResponse.getPaymentId()).get();</span>
<span class="nc" id="L52">            log.info(&quot;Final payment status: {}&quot;, paymentResponse);</span>
            
<span class="nc" id="L54">        } catch (InterruptedException | ExecutionException e) {</span>
<span class="nc" id="L55">            log.error(&quot;Error in payment example&quot;, e);</span>
<span class="nc" id="L56">        }</span>
        
<span class="nc" id="L58">        log.info(&quot;AP2 simple payment example completed&quot;);</span>
<span class="nc" id="L59">    }</span>
    
    /**
     * Create a sample payment-enabled agent card.
     *
     * @return The agent card.
     */
    private static PaymentEnabledAgentCard createAgentCard() {
<span class="nc" id="L67">        PaymentEnabledAgentCard agentCard = new PaymentEnabledAgentCard();</span>
        
        // Set basic properties
<span class="nc" id="L70">        agentCard.setName(&quot;Payment Agent&quot;);</span>
<span class="nc" id="L71">        agentCard.setDescription(&quot;An agent that can process payments&quot;);</span>
<span class="nc" id="L72">        agentCard.setUrl(&quot;https://example.com/payment-agent&quot;);</span>
<span class="nc" id="L73">        agentCard.setVersion(&quot;1.0.0&quot;);</span>
        
        // Set capabilities
<span class="nc" id="L76">        EnhancedCapabilities capabilities = new EnhancedCapabilities();</span>
<span class="nc" id="L77">        capabilities.setStreaming(true);</span>
<span class="nc" id="L78">        capabilities.setPushNotifications(true);</span>
<span class="nc" id="L79">        capabilities.setCustomCapability(&quot;paymentEnabled&quot;, true);</span>
<span class="nc" id="L80">        agentCard.setCapabilities(capabilities);</span>
        
        // Set authentication
<span class="nc" id="L83">        Authentication auth = new Authentication();</span>
<span class="nc" id="L84">        auth.setBearerAuth(&quot;api-key-123&quot;);</span>
<span class="nc" id="L85">        agentCard.setAuthentication(auth);</span>
        
        // Set payment properties
<span class="nc" id="L88">        agentCard.setPaymentProvider(createPaymentProvider());</span>
<span class="nc" id="L89">        agentCard.setSupportedPaymentMethods(new String[]{&quot;credit_card&quot;, &quot;wallet&quot;, &quot;bank_transfer&quot;});</span>
<span class="nc" id="L90">        agentCard.setSupportedCurrencies(new String[]{&quot;USD&quot;, &quot;EUR&quot;, &quot;GBP&quot;});</span>
<span class="nc" id="L91">        agentCard.setCanReceivePayments(true);</span>
<span class="nc" id="L92">        agentCard.setCanMakePayments(true);</span>
<span class="nc" id="L93">        agentCard.setRequiresAuthentication(true);</span>
        
<span class="nc" id="L95">        return agentCard;</span>
    }
    
    /**
     * Create a sample payment provider.
     *
     * @return The payment provider.
     */
    private static PaymentProvider createPaymentProvider() {
<span class="nc" id="L104">        return PaymentProvider.builder()</span>
<span class="nc" id="L105">                .id(&quot;sample-provider&quot;)</span>
<span class="nc" id="L106">                .name(&quot;Sample Payment Provider&quot;)</span>
<span class="nc" id="L107">                .description(&quot;A sample payment provider for demonstration&quot;)</span>
<span class="nc" id="L108">                .url(&quot;https://example.com/payment-provider&quot;)</span>
<span class="nc" id="L109">                .apiEndpoint(&quot;https://api.example.com/payments&quot;)</span>
<span class="nc" id="L110">                .type(&quot;multi&quot;)</span>
<span class="nc" id="L111">                .logoUrl(&quot;https://example.com/logo.png&quot;)</span>
<span class="nc" id="L112">                .build();</span>
    }
    
    /**
     * Create a sample payment request.
     *
     * @return The payment request.
     */
    private static PaymentRequest createPaymentRequest() {
<span class="nc" id="L121">        Map&lt;String, Object&gt; metadata = new HashMap&lt;&gt;();</span>
<span class="nc" id="L122">        metadata.put(&quot;orderId&quot;, UUID.randomUUID().toString());</span>
<span class="nc" id="L123">        metadata.put(&quot;customerName&quot;, &quot;John Doe&quot;);</span>
        
<span class="nc" id="L125">        return PaymentRequest.builder()</span>
<span class="nc" id="L126">                .amount(new BigDecimal(&quot;99.99&quot;))</span>
<span class="nc" id="L127">                .currencyCode(&quot;USD&quot;)</span>
<span class="nc" id="L128">                .requestingAgentId(&quot;agent-123&quot;)</span>
<span class="nc" id="L129">                .receivingAgentId(&quot;merchant-456&quot;)</span>
<span class="nc" id="L130">                .description(&quot;Purchase of Premium Service&quot;)</span>
<span class="nc" id="L131">                .metadata(metadata)</span>
<span class="nc" id="L132">                .externalReference(&quot;INV-2023-12345&quot;)</span>
<span class="nc" id="L133">                .callbackUrl(&quot;https://example.com/callback&quot;)</span>
<span class="nc" id="L134">                .paymentMethod(&quot;credit_card&quot;)</span>
<span class="nc" id="L135">                .build();</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.10.202304240956</span></div></body></html>